// NOTE for Wt 3.1.2
// This is not so safe, as WServer::post() is.
// If the application was deleted, this may cause segfault.
// Make sure not to call functors, returned from deleted applications

void do_func(boost::function<void()> func, WApplication* app) {
    if (!app->sessionId().empty()) {
        WApplication::UpdateLock lock = app->getUpdateLock();
        func();
    }
}

void thread_func(boost::function<void()> func, WApplication* app) {
    boost::thread(do_func, func, app);
}

boost::function<void()> bound_post(boost::function<void()> func) {
    return boost::bind(thread_func, func, wApp);
}

